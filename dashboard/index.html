<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Froth Flotation Control System</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Header Section -->
    <header class="header">
        <div class="header-left">
            <h1 class="app-title">‚öôÔ∏è Froth Flotation Control System</h1>
            <div class="connection-status" id="connectionStatus">
                <span class="status-dot status-connecting"></span>
                <span id="statusText">Connecting...</span>
            </div>
        </div>
        <div class="header-right">
            <div class="datetime" id="datetime"></div>
            <button class="theme-toggle" id="themeToggle" title="Toggle theme">üåô</button>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="main-content">
        
        <!-- Row 1: Video Feed & Metrics -->
        <div class="row-1">
            <!-- Live Video Feed -->
            <section class="video-section card">
                <div class="card-header">
                    <h2>üìπ Live Video Feed</h2>
                    <div class="video-controls">
                        <button id="playPauseBtn" class="btn btn-sm" title="Play/Pause">‚è∏Ô∏è</button>
                        <button id="snapshotBtn" class="btn btn-sm" title="Take Snapshot">üì∏</button>
                    </div>
                </div>
                <div class="video-container">
                    <canvas id="videoCanvas" width="640" height="480"></canvas>
                    <div class="video-overlay">
                        <span id="frameRate">0 FPS</span>
                        <span id="bubbleOverlay">Bubbles: 0</span>
                    </div>
                </div>
                <div class="video-status" id="videoStatus">
                    <span class="status-indicator status-active"></span>
                    <span>Camera Active - Processing frames</span>
                </div>
            </section>

            <!-- Real-time Metrics -->
            <section class="metrics-section card">
                <div class="card-header">
                    <h2>üìä Real-Time Metrics</h2>
                </div>
                <div class="metrics-grid">
                    <!-- Bubble Count -->
                    <div class="metric-card">
                        <div class="metric-icon">ü´ß</div>
                        <div class="metric-content">
                            <div class="metric-label">Bubble Count</div>
                            <div class="metric-value" id="bubbleCount">--</div>
                        </div>
                    </div>

                    <!-- Average Bubble Size -->
                    <div class="metric-card">
                        <div class="metric-icon">üìè</div>
                        <div class="metric-content">
                            <div class="metric-label">Avg. Bubble Size</div>
                            <div class="metric-value" id="avgBubbleSize">--</div>
                            <div class="metric-unit">pixels¬≤</div>
                        </div>
                    </div>

                    <!-- Froth Coverage -->
                    <div class="metric-card">
                        <div class="metric-icon">üìê</div>
                        <div class="metric-content">
                            <div class="metric-label">Froth Coverage</div>
                            <div class="metric-value" id="frothCoverage">--</div>
                            <div class="metric-unit">%</div>
                        </div>
                    </div>

                    <!-- Froth Stability -->
                    <div class="metric-card">
                        <div class="metric-icon">‚öñÔ∏è</div>
                        <div class="metric-content">
                            <div class="metric-label">Froth Stability</div>
                            <div class="metric-value" id="frothStability">--</div>
                            <div class="stability-bar">
                                <div class="stability-fill" id="stabilityFill" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                    <!-- System Status -->
                    <div class="metric-card anomaly-card" id="anomalyCard">
                        <div class="metric-icon">üö®</div>
                        <div class="metric-content">
                            <div class="metric-label">System Status</div>
                            <div class="metric-value anomaly-status" id="anomalyStatus">NORMAL</div>
                            <div class="metric-sublabel" id="anomalyTime">Last check: --</div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Row 2: Control Panel -->
        <div class="row-2">
            <section class="control-panel card">
                <div class="card-header">
                    <h2>üéõÔ∏è Control Panel</h2>
                </div>

                <!-- Mode Selector -->
                <div class="mode-selector">
                    <div class="mode-toggle">
                        <button class="mode-btn" id="autoModeBtn" data-mode="auto">
                            <span class="mode-icon">ü§ñ</span>
                            AUTO MODE
                        </button>
                        <button class="mode-btn active" id="manualModeBtn" data-mode="manual">
                            <span class="mode-icon">üë®‚Äçüíº</span>
                            MANUAL MODE
                        </button>
                    </div>
                    <div class="system-status-pills">
                        <span class="status-pill status-running" id="systemStatusPill">‚óè RUNNING</span>
                        <button class="btn btn-emergency" id="emergencyStopBtn">
                            üî¥ EMERGENCY STOP
                        </button>
                    </div>
                </div>

                <!-- Control Sections Container -->
                <div class="control-sections">
                    
                    <!-- Manual Controls (Default visible) -->
                    <div class="manual-controls" id="manualControls">
                        <div class="controls-grid">
                            
                            <!-- Peristaltic Pump Control -->
                            <div class="control-group">
                                <div class="control-header">
                                    <h3>üíß Peristaltic Pump</h3>
                                    <div class="control-status">
                                        <button class="status-toggle" id="pumpToggle" data-device="pump">
                                            <span class="status-dot status-stopped"></span>
                                            <span class="status-text">Stopped</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="control-body">
                                    <div class="slider-control">
                                        <label for="pumpSpeed">Speed (%)</label>
                                        <input type="range" id="pumpSpeed" min="0" max="100" value="0" class="slider">
                                        <div class="slider-value">
                                            <span id="pumpSpeedValue">0</span>%
                                        </div>
                                    </div>
                                    <div class="control-info">
                                        <span class="info-label">Flow Rate:</span>
                                        <span class="info-value" id="pumpFlowRate">0.0 mL/min</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Feed Pump Control -->
                            <div class="control-group">
                                <div class="control-header">
                                    <h3>‚ö° Feed Pump</h3>
                                    <div class="control-status">
                                        <button class="status-toggle" id="feedToggle" data-device="feed">
                                            <span class="status-dot status-stopped"></span>
                                            <span class="status-text">Stopped</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="control-body">
                                    <div class="slider-control">
                                        <label for="feedIntensity">Intensity (%)</label>
                                        <input type="range" id="feedIntensity" min="0" max="100" value="0" class="slider">
                                        <div class="slider-value">
                                            <span id="feedIntensityValue">0</span>%
                                        </div>
                                    </div>
                                    <div class="control-info">
                                        <span class="info-label">Feed Flow:</span>
                                        <span class="info-value" id="feedFlow">Stopped</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Air Pump Control -->
                            <div class="control-group">
                                <div class="control-header">
                                    <h3>üå¨Ô∏è Air Pump</h3>
                                    <div class="control-status">
                                        <button class="status-toggle" id="airToggle" data-device="air">
                                            <span class="status-dot status-stopped"></span>
                                            <span class="status-text">Stopped</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="control-body">
                                    <div class="slider-control">
                                        <label for="airIntensity">Intensity (%)</label>
                                        <input type="range" id="airIntensity" min="0" max="100" value="0" class="slider">
                                        <div class="slider-value">
                                            <span id="airIntensityValue">0</span>%
                                        </div>
                                    </div>
                                    <div class="control-info">
                                        <span class="info-label">Air Flow:</span>
                                        <span class="info-value" id="airFlow">Stopped</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Agitator Control -->
                            <div class="control-group">
                                <div class="control-header">
                                    <h3>üîÑ Agitator</h3>
                                    <div class="control-status">
                                        <button class="status-toggle" id="agitatorToggle" data-device="agitator">
                                            <span class="status-dot status-stopped"></span>
                                            <span class="status-text">Stopped</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="control-body">
                                    <div class="slider-control">
                                        <label for="agitatorSpeed">Speed (%)</label>
                                        <input type="range" id="agitatorSpeed" min="0" max="100" value="0" class="slider">
                                        <div class="slider-value">
                                            <span id="agitatorSpeedValue">0</span>%
                                        </div>
                                    </div>
                                    <div class="control-info">
                                        <span class="info-label">RPM:</span>
                                        <span class="info-value" id="agitatorRPM">0</span>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- Auto Controls (Hidden by default) -->
                    <div class="auto-controls" id="autoControls" style="display: none;">
                        <div class="controls-grid-auto">
                            
                            <!-- Auto Mode Status -->
                            <div class="control-group">
                                <div class="control-header">
                                    <h3>ü§ñ Automatic Control Active</h3>
                                </div>
                                <div class="control-body">
                                    <div class="control-info-group">
                                        <div class="control-info">
                                            <span class="info-label">Target Bubble Count:</span>
                                            <span class="info-value" id="piSetpointDisplay">120</span>
                                        </div>
                                        <div class="control-info">
                                            <span class="info-label">Current Output:</span>
                                            <span class="info-value" id="piOutput">0%</span>
                                        </div>
                                        <div class="control-info">
                                            <span class="info-label">Control Error:</span>
                                            <span class="info-value" id="piError">0</span>
                                        </div>
                                    </div>
                                    <div class="auto-mode-notice">
                                        <p>üîí System is running in automatic mode. PI controller is actively maintaining optimal froth conditions.</p>
                                        <p>‚ö†Ô∏è Peristaltic pump is controlled automatically. Feed pump, air pump, and agitator can be adjusted manually below.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Manual Controls for Auto Mode (Feed, Air, Agitator only) -->
                            <div class="controls-grid">
                                <!-- Feed Pump Control -->
                                <div class="control-group">
                                    <div class="control-header">
                                        <h3>‚ö° Feed Pump</h3>
                                        <div class="control-status">
                                            <button class="status-toggle" id="feedToggleAuto" data-device="feed">
                                                <span class="status-dot status-stopped"></span>
                                                <span class="status-text">Stopped</span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="control-body">
                                        <div class="slider-control">
                                            <label for="feedIntensityAuto">Intensity (%)</label>
                                            <input type="range" id="feedIntensityAuto" min="0" max="100" value="0" class="slider">
                                            <div class="slider-value">
                                                <span id="feedIntensityValueAuto">0</span>%
                                            </div>
                                        </div>
                                        <div class="control-info">
                                            <span class="info-label">Feed Flow:</span>
                                            <span class="info-value" id="feedFlowAuto">Stopped</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Air Pump Control -->
                                <div class="control-group">
                                    <div class="control-header">
                                        <h3>üå¨Ô∏è Air Pump</h3>
                                        <div class="control-status">
                                            <button class="status-toggle" id="airToggleAuto" data-device="air">
                                                <span class="status-dot status-stopped"></span>
                                                <span class="status-text">Stopped</span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="control-body">
                                        <div class="slider-control">
                                            <label for="airIntensityAuto">Intensity (%)</label>
                                            <input type="range" id="airIntensityAuto" min="0" max="100" value="0" class="slider">
                                            <div class="slider-value">
                                                <span id="airIntensityValueAuto">0</span>%
                                            </div>
                                        </div>
                                        <div class="control-info">
                                            <span class="info-label">Air Flow:</span>
                                            <span class="info-value" id="airFlowAuto">Stopped</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Agitator Control -->
                                <div class="control-group">
                                    <div class="control-header">
                                        <h3>üîÑ Agitator</h3>
                                        <div class="control-status">
                                            <button class="status-toggle" id="agitatorToggleAuto" data-device="agitator">
                                                <span class="status-dot status-stopped"></span>
                                                <span class="status-text">Stopped</span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="control-body">
                                        <div class="slider-control">
                                            <label for="agitatorSpeedAuto">Speed (%)</label>
                                            <input type="range" id="agitatorSpeedAuto" min="0" max="100" value="0" class="slider">
                                            <div class="slider-value">
                                                <span id="agitatorSpeedValueAuto">0</span>%
                                            </div>
                                        </div>
                                        <div class="control-info">
                                            <span class="info-label">RPM:</span>
                                            <span class="info-value" id="agitatorRPMAuto">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- Global System Controls -->
                    <div class="global-controls">
                        <div class="control-group">
                            <div class="control-header">
                                <h3>‚öôÔ∏è System Actions</h3>
                            </div>
                            <div class="control-body">
                                <div class="button-group">
                                    <button class="btn btn-success" id="startAllBtn">‚ñ∂Ô∏è START ALL</button>
                                    <button class="btn btn-danger" id="stopAllBtn">‚èπÔ∏è STOP ALL</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </section>
        </div>

        <!-- Row 3: System Status & Alerts -->
        <div class="row-3">
            <!-- System Status -->
            <section class="system-status card">
                <div class="card-header">
                    <h2>üíª System Health</h2>
                </div>
                <div class="hardware-status">
                    <h3>Hardware Status</h3>
                    <div class="status-grid">
                        <div class="status-item">
                            <span class="status-indicator status-active" id="cameraStatus"></span>
                            <span>Camera</span>
                        </div>
                        <div class="status-item">
                            <span class="status-indicator status-active" id="pumpStatusIndicator"></span>
                            <span>Pump</span>
                        </div>
                        <div class="status-item">
                            <span class="status-indicator status-active" id="networkStatus"></span>
                            <span>Network</span>
                        </div>
                        <div class="status-item">
                            <span class="status-indicator status-active" id="storageStatus"></span>
                            <span>Storage</span>
                        </div>
                    </div>
                </div>
                <div class="uptime-info">
                    <span class="info-label">System Uptime:</span>
                    <span class="info-value" id="uptime">00:00:00</span>
                </div>
            </section>

            <!-- Alerts & Logs -->
            <section class="alerts-section card">
                <div class="card-header">
                    <h2>üîî Alerts & Logs</h2>
                    <button class="btn btn-sm" id="clearAlertsBtn">Clear</button>
                </div>
                <div class="alerts-list" id="alertsList">
                    <div class="alert-item alert-info">
                        <span class="alert-timestamp">--:--:--</span>
                        <span class="alert-message">System initialized successfully</span>
                    </div>
                </div>
            </section>
        </div>

    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <span>¬© 2025 Froth Flotation Control System | NUST Project</span>
            <span>Version 1.0.0 | Raspberry Pi 5</span>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/app.js"></script>
    <script src="js/video_stream.js"></script>
</body>
</html>
